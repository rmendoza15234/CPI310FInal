let uuidv4,dbPromise;_5de‍.x([["grantAuthToken",()=>grantAuthToken],["lookupUserFromAuthToken",()=>lookupUserFromAuthToken]]);_5de‍.w("uuid",[["v4",["uuidv4"],function(v){uuidv4=v}]]);_5de‍.w("./index",[["dbPromise",["dbPromise"],function(v){dbPromise=v}]]); //importing v4 function from uuid and renaming it to uuidv4
 //importing dbPromise from index.js

//generate an auth token, store it in the database, return it and set it as a cookie
       const grantAuthToken = async (userId) => { //takes a userId and returns the access token so it can be set as a cookie
    const db = await _5de‍.a("dbPromise",dbPromise);
    const tokenString = _5de‍.a("uuidv4",uuidv4)(); //token string made up of random characters
    await db.run("INSERT INTO AuthTokens (token, userId) VALUES (?, ?);", tokenString, userId); //stores the authToken into the AuthTokens table

    return tokenString;
};_5de‍.j(["grantAuthToken"]);

       const lookupUserFromAuthToken = async (authToken) => { //looks for the user based on the specific authToken
    const db = await _5de‍.a("dbPromise",dbPromise)
    const token = await db.get("SELECT * FROM AuthTokens WHERE token=?;", authToken);
    
    if(!token) //checks if the user is submitting using old authTokens (if the user logs out, then their authToken needs to be deleted from the database)
    {
        return null; //if there is no token, returns null
    }
    const user = await db.get("SELECT id, email, username FROM Users WHERE id=?;", token.userId);
    
    return user;
};_5de‍.j(["lookupUserFromAuthToken"]);